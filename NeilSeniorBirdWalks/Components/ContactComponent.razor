@using System.ComponentModel.DataAnnotations
@using NeilSeniorBirdWalks.Models
@using NeilSeniorBirdWalks.Services
@inject IContactService ContactService
@inject NavigationManager NavigationManager

<MudCard>
	<MudCardHeader Style="justify-content: center; text-align: center;">
		<MudText Typo="Typo.h3">Contact Us</MudText>
	</MudCardHeader>

    <MudCardContent>
        <MudForm @ref="form" Model="@contactForm" @bind-IsValid="@success" ValidationDelay="0">
            <MudTextField T="string"
                          Label="Name"
                          @bind-Value="contactForm.Name"
                          Required="true"
                          RequiredError="Name is required" />

            <MudTextField T="string"
                          Label="Email"
                          @bind-Value="contactForm.Email"
                          Required="true"
                          RequiredError="Email is required"
                          Validation="@(new EmailAddressAttribute() {ErrorMessage = "Please enter a valid email address"})" />

            <MudTextField T="string"
                          Label="Phone"
                          @bind-Value="contactForm.Phone"
                          Validation="@(new RegularExpressionAttribute(@"^(\+\d{1,3}[- ]?)?\d{10,15}$") { ErrorMessage = "Please enter a valid phone number" })" />
            
						

            <MudTextField T="string"
                          Label="Subject"
                          @bind-Value="contactForm.Subject"
                          Required="true"
                          RequiredError="Subject is required" />

            <MudTextField T="string"
                          Label="Message"
                          @bind-Value="contactForm.Message"
                          Required="true"
                          RequiredError="Message is required"
                          Lines="5" />
        </MudForm>
    </MudCardContent>

    <MudCardActions>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   DisableElevation="true"
                   OnClick="HandleValidSubmit">Submit</MudButton>
    </MudCardActions>
</MudCard>

@if (showSuccessMessage)
{
    <MudAlert Severity="Severity.Success" Class="mt-3" ShowCloseIcon="true" CloseIconClicked="() => showSuccessMessage = false">
        Your message has been sent successfully. We will contact you soon.
    </MudAlert>
}

@code {
    private ContactFormModel contactForm = new ContactFormModel();
    private bool showSuccessMessage = false;
    private bool success;
    private MudForm form;

    private async Task HandleValidSubmit()
    {
        await form.Validate();

        if (success)
        {
            var result = await ContactService.SubmitContactFormAsync(contactForm);
            if (result)
            {
                showSuccessMessage = true;
                contactForm = new ContactFormModel();
                form.ResetAsync();
            }
        }
    }
}